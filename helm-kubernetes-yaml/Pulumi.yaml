name: ${PROJECT}
description: ${DESCRIPTION}
runtime: yaml
template:
  description: A Pulumi YAML program to deploy a Helm chart onto a Kubernetes cluster
  config:
    k8sNamespace:
      default: ingress-nginx
      description: The Kubernetes namespace to deploy into

config:
  # Use this user-supplied value to create a Kubernetes namespace later
  k8sNamespace:
    default: ingress-nginx
    type: string

variables:
  # Define some labels that will be applied to resources
  appLabels:
    app: ingress-nginx

resources:
  # Create a namespace (name of the namespace supplied by the user)
  ingressns:
    type: kubernetes:core/v1:Namespace
    properties:
      metadata:
        labels: ${appLabels}
        name: ${k8sNamespace}
  # Use Helm to install the Nginx ingress controller
  ingresscontroller:
    type: kubernetes:helm.sh/v3:Release
    properties:
      chart: ingress-nginx
      namespace: ${ingressns.metadata.name}
      repositoryOpts:
        repo: https://kubernetes.github.io/ingress-nginx
      skipCrds: true
      values:
        serviceAccount:
          automountServiceAccountToken: true
        controller:
          publishService:
            enabled: true
      version: 4.11.3

# Export some values for use elsewhere
outputs:
    name: ${ingresscontroller.name}
